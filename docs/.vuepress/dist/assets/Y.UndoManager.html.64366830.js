import{_ as n,o as s,c as a,a as t}from"./app.544e4f17.js";const p={},e=t(`<h1 id="y-undomanager" tabindex="-1"><a class="header-anchor" href="#y-undomanager" aria-hidden="true">#</a> Y.UndoManager</h1><p>\u53EF\u9009\u7684yjs\u64A4\u9500\u91CD\u505A\u7BA1\u7406\u5668\u3002</p><p>Yjs ships with a selective Undo/Redo manager. The changes can be optionally scoped to transaction origins.</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> <span class="token constant">Y</span> <span class="token keyword">from</span> <span class="token string">&#39;yjs&#39;</span>

<span class="token keyword">const</span> ytext <span class="token operator">=</span> doc<span class="token punctuation">.</span><span class="token function">getText</span><span class="token punctuation">(</span><span class="token string">&#39;text&#39;</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> undoManager <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Y<span class="token punctuation">.</span>UndoManager</span><span class="token punctuation">(</span>ytext<span class="token punctuation">)</span>

ytext<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">&#39;abc&#39;</span><span class="token punctuation">)</span>
undoManager<span class="token punctuation">.</span><span class="token function">undo</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
ytext<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// =&gt; &#39;&#39;</span>
undoManager<span class="token punctuation">.</span><span class="token function">redo</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
ytext<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// =&gt; &#39;abc&#39;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong><code>const undoManager = new Y.UndoManager(scope: Y.AbstractType | Array&lt;Y.AbstractType&gt; [, {captureTimeout: number, trackedOrigins: Set&lt;any&gt;, deleteFilter: function(item):boolean}])</code></strong></p><p>\u5728\u5171\u4EAB\u7C7B\u578B\u4E0A\u8239\u8230\u4E00\u4E2A\u64A4\u9500\u91CD\u505A\u7BA1\u7406\u5668\u3002\u5982\u679C\u4EFB\u4F55\u6307\u5B9A\u7684\u7C7B\u578B\u6216\u8005\u5176\u5B50\u7C7B\u578B\u88AB\u4FEE\u6539\u5219\u4F1A\u5411\u64A4\u9500\u91CD\u505A\u7BA1\u7406\u5668\u7684\u5806\u6808\u4E2D\u6DFB\u52A0\u4E00\u4E2A\u53CD\u5411\u64CD\u4F5C\u3002\u6216\u8005\u901A\u8FC7<code>trackedOrigins</code>\u5C5E\u6027\u8FC7\u6EE4\u9700\u8981\u8DDF\u8E2A\u4FEE\u6539\u7684\u7C7B\u578B\uFF0C\u5426\u5219\u9ED8\u8BA4\u4E0B\u5C06\u8DDF\u8E2A\u672C\u5730\u6240\u6709\u7C7B\u578B\u7684\u4FEE\u6539\u3002 \u540C\u65F6\u7BA1\u7406\u5668\u5185\u90E8\u4F1A\u5BF9\u4E8B\u4EF6\u4FEE\u6539\u505A\u8282\u6D41\u64CD\u4F5C\uFF0C\u5C0F\u4E8E<code>captureTimeout</code>\u65F6\u95F4\u7684\u4FEE\u6539\u5C06\u4F1A\u88AB\u5408\u5E76\u6210\u4E00\u4E2A\uFF0C\u5C06\u5176\u8BBE\u7F6E\u4E3A0\u5373\u53EF\u83B7\u53D6\u5230\u6BCF\u6B21\u66F4\u6539\u3002</p><p><strong><code>undoManager.undo()</code></strong></p><p>\u64A4\u9500\u6700\u65B0\u4E00\u6B21\u6267\u884C\u7684\u64CD\u4F5C\uFF0C\u540C\u65F6\u5C06\u76F8\u53CD\u7684\u64CD\u4F5C\u63A8\u5165\u5230redo\u5806\u6808\u4E2D</p><p><strong><code>undoManager.redo()</code></strong></p><p>\u91CD\u505Aredo\u5806\u6808\u4E0A\u7684\u6700\u540E\u4E00\u4E2A\u64CD\u4F5C\u3002Redo the last operation on the redo-stack. I.e. the previous redo is reversed.</p><p><strong><code>undoManager.stopCapturing()</code></strong></p><p>\u786E\u4FDD\u4E0B\u6B21\u4E8B\u4EF6\u4E0D\u4F1A\u88AB\u6355\u83B7\u3002</p><p><strong><code>undoManager.clear()</code></strong></p><p>\u6E05\u9664\u64A4\u9500/\u91CD\u505A\u5806\u6808\u4E2D\u7684\u6240\u6709\u64CD\u4F5C\u3002</p><p><strong><code>undoManager.on(&#39;stack-item-added&#39;, {stackItem: { meta: Map&lt;any,any&gt;, type: &#39;undo&#39;|&#39;redo&#39;}}</code></strong></p><p>\u5F53\u64CD\u4F5C\u88AB\u6DFB\u52A0\u5230redo/undo\u5806\u6808\u4E2D\u65F6\u89E6\u53D1\u7684\u4E8B\u4EF6\u3002</p><p><strong><code>on(&#39;stack-item-popped&#39;, { stackItem: { meta: Map&lt;any,any&gt; }, type: &#39;undo&#39; | &#39;redo&#39; })</code></strong></p><p>\u64CD\u4F5C\u5F39\u51FA\u65F6\u89E6\u53D1\u7684\u4E8B\u4EF6\u3002</p><h2 id="example-stop-capturing" tabindex="-1"><a class="header-anchor" href="#example-stop-capturing" aria-hidden="true">#</a> Example: Stop Capturing</h2><p>\u65F6\u95F4\u95F4\u9694\u5C0F\u4E8E<code>options.captureTimeout</code>\u7684\u4FEE\u6539\u5C06\u4F1A\u88AB\u5408\u5E76\uFF0C\u8C03\u7528<code>stopCapturing</code>\u65B9\u6CD5\u4EE5\u786E\u4FDD\u4E0B\u4E00\u6B21\u4FEE\u6539\u662F\u72EC\u7ACB\u7684\u4E0D\u4F1A\u88AB\u5408\u5E76\u3002</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// without stopCapturing</span>
ytext<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">&#39;a&#39;</span><span class="token punctuation">)</span>
ytext<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">&#39;b&#39;</span><span class="token punctuation">)</span>
undoManager<span class="token punctuation">.</span><span class="token function">undo</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
ytext<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// =&gt; &#39;&#39; (note that &#39;ab&#39; was removed)</span>

<span class="token comment">// with stopCapturing</span>
ytext<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">&#39;a&#39;</span><span class="token punctuation">)</span>
undoManager<span class="token punctuation">.</span><span class="token function">stopCapturing</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
ytext<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">&#39;b&#39;</span><span class="token punctuation">)</span>
undoManager<span class="token punctuation">.</span><span class="token function">undo</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
ytext<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// =&gt; &#39;a&#39; (note that only &#39;b&#39; was removed)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="example-specify-tracked-origins" tabindex="-1"><a class="header-anchor" href="#example-specify-tracked-origins" aria-hidden="true">#</a> Example: Specify tracked origins</h2><p>\u6587\u6863\u7684\u6BCF\u6B21\u4FEE\u6539\u90FD\u6709\u5176\u6765\u6E90\u3002\u5982\u679C\u4FEE\u6539\u7684\u6765\u6E90\u6CA1\u6709\u88AB\u6307\u5B9A\uFF0C\u90A3\u4E48\u4ED6\u9ED8\u8BA4\u662F<code>null</code>\u3002\u901A\u8FC7\u6307\u5B9A<code>trackedOrigins</code>\u5C5E\u6027\u4F60\u53EF\u4EE5\u9009\u62E9\u6027\u7684\u51B3\u5B9A\u54EA\u4E9B\u6765\u6E90\u7684\u4FEE\u6539\u5E94\u8BE5\u88AB\u8DDF\u8E2A\u3002</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">class</span> <span class="token class-name">CustomBinding</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token keyword">const</span> ytext <span class="token operator">=</span> doc<span class="token punctuation">.</span><span class="token function">getText</span><span class="token punctuation">(</span><span class="token string">&#39;text&#39;</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> undoManager <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Y<span class="token punctuation">.</span>UndoManager</span><span class="token punctuation">(</span>ytext<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">trackedOrigins</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">42</span><span class="token punctuation">,</span> CustomBinding<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

ytext<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">&#39;abc&#39;</span><span class="token punctuation">)</span>
undoManager<span class="token punctuation">.</span><span class="token function">undo</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
ytext<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// =&gt; &#39;abc&#39; (abc\u7684\u66F4\u6539\u6CA1\u6709\u88AB\u8DDF\u8E2A\u56E0\u4E3A\u5176\u6765\u6E90\u662Fnull\uFF0C\u5E76\u4E14null\u4E0D\u5728trackedOrigins\u4E2D)</span>
ytext<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token comment">// revert change</span>

doc<span class="token punctuation">.</span><span class="token function">transact</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  ytext<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">&#39;abc&#39;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">42</span><span class="token punctuation">)</span>
undoManager<span class="token punctuation">.</span><span class="token function">undo</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
ytext<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// =&gt; &#39;&#39; (tracked because origin is an instance of \`trackedTransactionorigins\`)</span>

doc<span class="token punctuation">.</span><span class="token function">transact</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  ytext<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">&#39;abc&#39;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">41</span><span class="token punctuation">)</span>
undoManager<span class="token punctuation">.</span><span class="token function">undo</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
ytext<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// =&gt; &#39;&#39; (not tracked because 41 is not an instance of</span>
                 <span class="token comment">//        \`trackedTransactionorigins\`)</span>
ytext<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token comment">// revert change</span>

doc<span class="token punctuation">.</span><span class="token function">transact</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  ytext<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">&#39;abc&#39;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">CustomBinding</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
undoManager<span class="token punctuation">.</span><span class="token function">undo</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
ytext<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// =&gt; &#39;&#39; (tracked because origin is a \`CustomBinding\` and</span>
                 <span class="token comment">//        \`CustomBinding\` is in \`trackedTransactionorigins\`)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4E0A\u9762\u8FD9\u4E2A\u793A\u4F8B\u6211\u89C9\u5F97\u6700\u91CD\u8981\u7684\u5C31\u662F\u5C55\u793A\u4E86\u5982\u4F55\u6307\u5B9A\u4FEE\u6539\u7684\u6765\u6E90\u4EE5\u53CA\u81EA\u5B9A\u4E49\u7C7B\u4E5F\u662F\u53EF\u4EE5\u4F5C\u4E3A<code>trackedOrigins</code>\u5143\u7D20\u7684\u3002</p><h2 id="example-add-additional-information-to-the-stackitems" tabindex="-1"><a class="header-anchor" href="#example-add-additional-information-to-the-stackitems" aria-hidden="true">#</a> Example: Add additional information to the StackItems</h2><p>\u5F53\u6267\u884C\u64A4\u9500\u6216\u8005\u91CD\u505A\u64CD\u4F5C\u65F6\u901A\u5E38\u4F1A\u6062\u590D\u4E00\u4E9B\u5143\u4FE1\u606F\uFF0C\u6BD4\u5982\u5149\u6807\u7684\u4F4D\u7F6E\u3002\u4F60\u53EF\u4EE5\u901A\u8FC7\u6DFB\u52A0\u76D1\u542C\u4E8B\u4EF6\u6765\u5C06\u8FD9\u4E9B\u4FE1\u606F\u6062\u590D\u5230\u64CD\u4F5C\u5BF9\u8C61\u4E2D\u3002</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> ytext <span class="token operator">=</span> doc<span class="token punctuation">.</span><span class="token function">getText</span><span class="token punctuation">(</span><span class="token string">&#39;text&#39;</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> undoManager <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Y<span class="token punctuation">.</span>UndoManager</span><span class="token punctuation">(</span>ytext<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">trackedOrigins</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">42</span><span class="token punctuation">,</span> CustomBinding<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

undoManager<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&#39;stack-item-added&#39;</span><span class="token punctuation">,</span> <span class="token parameter">event</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// \u5F53\u4E8B\u4EF6\u88AB\u6DFB\u52A0\u5230\u5806\u6808\u4E2D\u65F6\u4FDD\u5B58\u5F53\u524D\u5149\u6807\u4F4D\u7F6E</span>
  event<span class="token punctuation">.</span>stackItem<span class="token punctuation">.</span>meta<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&#39;cursor-location&#39;</span><span class="token punctuation">,</span> <span class="token function">getRelativeCursorLocation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

undoManager<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&#39;stack-item-popped&#39;</span><span class="token punctuation">,</span> <span class="token parameter">event</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// \u6062\u590D\u5149\u6807\u4F4D\u7F6E</span>
  <span class="token function">restoreCursorLocation</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>stackItem<span class="token punctuation">.</span>meta<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&#39;cursor-location&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,28),o=[e];function c(i,u){return s(),a("div",null,o)}var r=n(p,[["render",c],["__file","Y.UndoManager.html.vue"]]);export{r as default};
